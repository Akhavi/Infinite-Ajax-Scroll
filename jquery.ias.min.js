/*!
 * Infinite Ajax Scroll, a jQuery plugin 
 * Version v0.1.2-farooq
 * http://webcreate.nl/
 *
 * Copyright (c) 2011 Jeroen Fiege
 * Licensed under the MIT License: 
 * http://webcreate.nl/license
 */
(function(b){b.ias=function(d){var n=b.extend({},b.ias.defaults,d);var c=new b.ias.util();var j=new b.ias.paging();var h=new b.ias.history();var f=this;function s(){j.onChangePage(function(y,w,x){h.setPage(y,x);n.onPageChange.call(this,y,x,w)});t();if(n.firstPage){r();p();e(n.firstPage,function(y,w){for(i=0;i<w.length;i++){var x=w[i];x.hide();curLastItem=b(n.container).find(n.item).last();curLastItem.after(x);x.fadeIn()}b(n.pagination).replaceWith(b(n.pagination,y));l();t();k()});return f}else{k()}return f}function k(){if(h.havePage()){r();pageNum=h.getPage();c.forceScrollTop(function(){if(pageNum>1){m(pageNum);curTreshold=q();b("html,body").scrollTop(curTreshold)}else{t()}})}}function t(){o();b(window).scroll(g)}function g(){scrTop=b(window).scrollTop();wndHeight=b(window).height();curScrOffset=scrTop+wndHeight;if(curScrOffset>=q()){u(curScrOffset)}}function r(){b(window).unbind("scroll",g)}function o(){b(n.pagination).hide()}function q(){el=b(n.container).find(n.item).last();if(el.size()==0){return 0}treshold=el.offset().top+el.height();return treshold}function u(x,w){urlNextPage=b(n.next).attr("href");if(!urlNextPage){return r()}j.pushPages(x,urlNextPage);r();p();e(urlNextPage,function(A,y){for(i=0;i<y.length;i++){var z=y[i];z.hide();curLastItem=b(n.container).find(n.item).last();curLastItem.after(z);z.fadeIn()}b(n.pagination).replaceWith(b(n.pagination,A));l();t();if(w){w.call(this)}})}function e(x,y){var w=[];b.get(x,null,function(z){b(n.container,z).find(n.item).each(function(){w.push(b(this))});if(y){y.call(this,z,w)}},"html")}function m(w){curTreshold=q();if(curTreshold>0){u(curTreshold,function(){r();if((j.getCurPageNum(curTreshold)+1)<w){m(w);b("html,body").animate({scrollTop:curTreshold},400,"swing")}else{b("html,body").animate({scrollTop:curTreshold},1000,"swing");t()}})}}function v(){loader=b(".ias_loader");if(loader.size()==0){loader=b("<div class='ias_loader'><img src='"+n.loader+"'/></div>");loader.hide()}return loader}function p(w){loader=v();el=b(n.container).find(n.item).last();el.after(loader);loader.fadeIn()}function l(){loader=v();loader.remove()}this.prependPage=function(w){e(w,function(z,x){for(i=0;i<x.length;i++){var y=x[i];y.hide();curFirstItem=b(n.container).find(n.item).first();curFirstItem.before(y);y.fadeIn()}})};return s()};function a(c){if(window.console&&window.console.log){window.console.log(c)}}b.ias.defaults={container:"#container",item:".item",pagination:"#pagination",next:".next",onPageChange:function(){},firstPage:false};b.ias.util=function(){var d=false;var f=false;var c=this;e();function e(){b(window).load(function(){d=true})}this.forceScrollTop=function(g){b("html,body").scrollTop(0);if(!f){if(!d){setTimeout(function(){c.forceScrollTop(g)},1)}else{g.call();f=true}}}};b.ias.paging=function(){var e=[[0,document.location.toString()]];var h=function(){};var d=1;j();function j(){b(window).scroll(g)}function g(){scrTop=b(window).scrollTop();wndHeight=b(window).height();curScrOffset=scrTop+wndHeight;curPageNum=c(curScrOffset);curPagebreak=f(curScrOffset);if(d!=curPageNum){h.call(this,curPageNum,curPagebreak[0],curPagebreak[1])}d=curPageNum}function c(k){for(i=(e.length-1);i>0;i--){if(k>e[i][0]){return i+1}}return 1}this.getCurPageNum=function(k){return c(k)};function f(k){for(i=(e.length-1);i>=0;i--){if(k>e[i][0]){return e[i]}}return null}this.onChangePage=function(k){h=k};this.pushPages=function(k,l){e.push([k,l])}};b.ias.controller=function(){c();function c(){}};b.ias.history=function(){var d=false;var c=false;e();function e(){c=!!(window.history&&history.pushState&&history.replaceState);c=false}this.setPage=function(g,f){this.updateState({page:g},"",f)};this.havePage=function(){return(this.getState()!=false)};this.getPage=function(){if(this.havePage()){stateObj=this.getState();return stateObj.page}return 1};this.getState=function(){if(c){stateObj=history.state;if(stateObj&&stateObj.ias){return stateObj.ias}}else{haveState=(window.location.hash.substring(0,7)=="#/page/");if(haveState){pageNum=parseInt(window.location.hash.replace("#/page/",""));return{page:pageNum}}}return false};this.updateState=function(g,h,f){if(d){this.replaceState(g,h,f)}else{this.pushState(g,h,f)}};this.pushState=function(g,h,f){if(c){hash=(g.page>0?"#/page/"+g.page:"");history.pushState({ias:g},h,hash)}else{hash=(g.page>0?"#/page/"+g.page:"");window.location.hash=hash}d=true};this.replaceState=function(g,h,f){if(c){hash=(g.page>0?"#/page/"+g.page:"");history.replaceState({ias:g},h,hash)}else{hash=(g.page>0?"#/page/"+g.page:"");window.location.hash=hash}}}})(jQuery);